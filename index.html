<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Relatório de Atendimento - Edição 31</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root { --line:#222; --muted:#444; }
    body { font-family: Arial, Helvetica, sans-serif; background:#f3f3f3; margin:0; }
    .topbar{
      position: sticky; top:0; z-index:10;
      background:#fff; border-bottom:1px solid #ddd;
      padding:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
    }
    button{
      border:1px solid #ccc; background:#fff; padding:10px 12px; border-radius:10px;
      font-weight:700; cursor:pointer;
    }
    button.primary{ border-color:#111; }
    .page{
      background:#fff; width:min(820px, 100%); margin:12px auto; padding:22px;
      box-shadow:0 6px 22px rgba(0,0,0,.08); border-radius:14px;
    }
    .header{ display:flex; flex-direction:column; align-items:center; gap:10px; }
    .logo{ width:90px; height:auto; }
    h1{ margin:0; font-size:22px; text-align:center; }
    .row{ display:flex; gap:16px; flex-wrap:wrap; margin-top:14px; }
    .field{ display:flex; align-items:center; gap:8px; flex:1; min-width:220px; }
    .label{ font-size:14px; color:#111; white-space:nowrap; }
    input[type="text"], input[type="time"], input[type="number"], input[type="date"]{
      width:100%; border:none; border-bottom:2px solid var(--line);
      padding:6px 4px; font-size:14px; outline:none;
    }
    .checks{ display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    .checks label{ font-size:14px; }
    .section-title{ margin:18px 0 8px; font-weight:700; }
    textarea{
      width:100%; border:none; outline:none; resize:vertical;
      border-top:1px solid #ddd; padding-top:10px;
      font-size:14px; line-height:1.6;
      background-image: linear-gradient(to bottom, transparent 31px, rgba(0,0,0,.55) 32px, transparent 33px);
      background-size: 100% 33px;
      min-height: 360px;
    }
    .list{
      display:grid; gap:10px; margin-top:6px;
    }
    .list .item{ display:flex; gap:8px; align-items:center; }
    .x{ width:16px; text-align:center; font-weight:700; }
    .line-input{
      width:100%; border:none; border-bottom:2px solid var(--line);
      padding:6px 4px; font-size:14px; outline:none;
    }

    @media print{
      body{ background:#fff; }
      .topbar{ display:none !important; }
      .page{ box-shadow:none; margin:0; border-radius:0; width:auto; }
      textarea{
        background-image: linear-gradient(to bottom, transparent 31px, rgba(0,0,0,.55) 32px, transparent 33px);
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <button class="primary" onclick="saveForm()">Salvar</button>
    <button onclick="loadForm()">Carregar</button>
    <button onclick="clearForm()">Limpar</button>
    <button class="primary" onclick="exportPDF()">Gerar PDF (Imprimir)</button>
  </div>

  <div class="page" id="printArea">
    <div class="header">
      <img class="logo" src="logo.png" alt="Logo" />
      <h1>Relatório de Atendimento Sobrenatural - Edição 31</h1>
    </div>

    <div class="row">
      <div class="field">
        <div class="label">Data:</div>
        <input id="data" type="date" />
      </div>

      <div class="field">
        <div class="label">Horário:</div>
        <input id="hora" type="time" />
      </div>

      <div class="checks">
        <label><input id="tipoNatural" type="radio" name="tipo" value="Natural"> Natural</label>
        <label><input id="tipoSobrenatural" type="radio" name="tipo" value="Sobrenatural"> Sobrenatural</label>
      </div>
    </div>

    <div class="row">
      <div class="field" style="min-width:320px; flex:2;">
        <div class="label">Nome:</div>
        <input id="nome" type="text" />
      </div>
      <div class="field" style="min-width:180px; flex:1;">
        <div class="label">Idade:</div>
        <input id="idade" type="number" inputmode="numeric" />
      </div>
    </div>

    <div class="section-title">Descrição do Incidente:</div>
    <textarea id="descricao"></textarea>

    <div class="section-title">Recursos Utilizados:</div>
    <div class="list">
      <div class="item"><div class="x">×</div><input class="line-input" id="rec1" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="rec2" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="rec3" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="rec4" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="rec5" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="rec6" type="text"></div>
    </div>

    <div class="row" style="margin-top:18px;">
      <div class="checks" style="flex:1;">
        <div class="label" style="font-weight:700;">Tomou Medicação:</div>
        <label><input id="medSim" type="radio" name="med" value="Sim"> Sim</label>
        <label><input id="medNao" type="radio" name="med" value="Não"> Não</label>
      </div>
      <div class="field" style="flex:2; min-width:260px;">
        <div class="label">Qual:</div>
        <input id="medQual" type="text">
      </div>
    </div>

    <div class="list" style="margin-top:10px;">
      <div class="item"><div class="x">×</div><input class="line-input" id="med1" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="med2" type="text"></div>
      <div class="item"><div class="x">×</div><input class="line-input" id="med3" type="text"></div>
    </div>

    <div class="row" style="margin-top:18px;">
      <div class="field" style="min-width:320px;">
        <div class="label" style="font-weight:700;">Responsável pelo atendimento</div>
        <input id="responsavel" type="text" />
      </div>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
    }

    const KEY = "relatorio_ed31_v1";

    function getFormData(){
      const tipo = document.querySelector('input[name="tipo"]:checked')?.value || "";
      const med = document.querySelector('input[name="med"]:checked')?.value || "";
      return {
        data: v("data"),
        hora: v("hora"),
        tipo,
        nome: v("nome"),
        idade: v("idade"),
        descricao: v("descricao"),
        recursos: [v("rec1"),v("rec2"),v("rec3"),v("rec4"),v("rec5"),v("rec6")],
        med,
        medQual: v("medQual"),
        meds: [v("med1"),v("med2"),v("med3")],
        responsavel: v("responsavel")
      };
    }

    function setFormData(d){
      s("data", d.data || "");
      s("hora", d.hora || "");
      checkRadio("tipo", d.tipo || "");
      s("nome", d.nome || "");
      s("idade", d.idade || "");
      s("descricao", d.descricao || "");
      (d.recursos || []).forEach((val,i)=> s("rec"+(i+1), val || ""));
      checkRadio("med", d.med || "");
      s("medQual", d.medQual || "");
      (d.meds || []).forEach((val,i)=> s("med"+(i+1), val || ""));
      s("responsavel", d.responsavel || "");
    }

    function saveForm(){
      localStorage.setItem(KEY, JSON.stringify(getFormData()));
      alert("Salvo no aparelho ✅");
    }

    function loadForm(){
      const raw = localStorage.getItem(KEY);
      if(!raw){ alert("Não encontrei nada salvo."); return; }
      setFormData(JSON.parse(raw));
      alert("Carregado ✅");
    }

    function clearForm(){
      if(!confirm("Limpar tudo?")) return;
      setFormData({});
      localStorage.removeItem(KEY);
    }

    function exportPDF(){
      window.print();
    }

    function v(id){ return document.getElementById(id).value; }
    function s(id,val){ document.getElementById(id).value = val; }

    function checkRadio(name, value){
      const radios = document.querySelectorAll('input[name="'+name+'"]');
      radios.forEach(r => r.checked = (r.value === value));
    }
  </script>
</body>
</html>
